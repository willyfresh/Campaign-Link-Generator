<html>
  <head>
    <title>Campaign Link Generator</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Will Floyd">
    <!-- bootstrap css -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <!-- custom css -->
    <style>
      /*customcss*/
    </style>
  </head>
  <body>
<!--
removing navigation until i have some conent written for the planned pages
========================================================================== 
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="demo.html">Campaign Link Generator</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="demo.html">Demo</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="docsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Docs
            </a>
            <div class="dropdown-menu" aria-labelledby="docsDropdown">
              <a class="dropdown-item" href="docs.html#start">Getting Started</a>
              <a class="dropdown-item" href="docs.html#specs">Specifications</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="docs.html#campaigns">Approved Campaigns</a>
            </div>
          </li>
        </ul>
      </div>
    </nav>
-->
    <div class="container">
			<div id="Campaign-Link-Generator">
				<h1>Campaign Link Generator</h1>
				<p>California Office of Statewide Health Planning and Development (OSHPD)</p>
				<hr>

				<!-- URL -->
				<div id="url-param" class="form-group">
					<label for="url-param-entry" id="url-param-label"><h2>Page URL</h2></label>
					<p>Copy and Paste the Link here
					<div class="input-group input-group-sm">
						<input type="text" class="form-control" id="url-param-entry" aria-describedby="url-param-label">
					</div>
					<hr>
				</div>

				<!-- CAMPAIGN -->
				<div id="campaign-param" class="form-group">
					<label for="campaign-param-entry" id="campaign-param-label"><h2>Campaign Name</h2></label>
					<input type="text" class="form-control" id="campaign-param-entry"  aria-describedby="campaign-param-help">
					<small id="campaign-param-help" class="form-text text-muted">Product, promo code, or slogan. Please use an approved campaign name. Be sure to follow our campaign parameter specifications.</small>
					<hr>
				</div>

				<!-- SOURCE/MEDIUM -->
				<div id="source-param" class="form-group">
					<label for="source-param-entry" id="source-param-label"><h2>Campaign Source</h2></label>
					<table class="table table-bordered">
						<thead>
							<tr>
								<th>External Sources</th>
								<th>Internal Sources</th>
							</tr>
						</thead>
						<tbody>
							<tr><td colspan="2">Source selections loading...</td></tr>
						</tbody>
					</table>

					<small id="utm-source-help" class="form-text text-muted">The referrer (e.g. facebook, mailchimp). Marketing medium is determined automatically.</small>
					<hr>
				</div>

				<!-- CONTENT -->
				<div id="content-param" class="form-group">
					<label for="utm-content" id="content-param-label"><h2>Link Description</h2></label>
					<input type="text" class="form-control" id="content-param-entry"  aria-describedby="content-param-help">
					<small id="content-param-help" class="form-text text-muted">Use to differentiate ads. Be sure to follow our campaign parameter specifications.</small>
					<hr>
				</div>

				<!-- TERMS -->
				<div id="term-param" class="form-group">
					<label for="term-param-entry" id="term-param-label"><h2>Paid Keywords</h2></label>
					<input type="text" class="form-control" id="term-param-entry"  aria-describedby="term-param-help">
					<small id="term-param-help" class="form-text text-muted"></small>
					<hr>
				</div>

				<!-- RESULTS -->
				<div id="generated-url" class="">
					<h2>Results</h2>
					<div class="p-3 mb-2 bg-light text-dark">
						<p id="gen-result"></p>
						<p id="gen-buttons">
							<button type="button" class="btn btn-outline-primary" onclick="generateLink();">Generate Link</button>
						</p>
					</div>
				</div>

			</div>
    </div>
    <!-- bootstraps -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
		<!-- dependencies -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>

    <!-- custom javascript -->
    <script type="text/javascript">
			/*
			==============================
			generator settings
			puts all our eggs in one json
			==============================
			*/
			
      const settings = {
        'domain':'https://oshpd.ca.gov/',
        'campaigns':[
					// add some campaigns yo!
				],
        'sources':{
          'external':{
            'email':[
							'StreamSend',
							'MailChimp'
						],
						'social':[
							'Facebook',
							'Twitter',
							'Linkedin'
						]
					},
          'internal':{
						'website':[
							'Front-Page-Carousel',
							'Atlas-Decommission',
							'Pop-up-Promo'
						]
					}
        },
        'content':'anything but no',
        'term':'no'
      }
			/*
			============================================
			source table arrays made global
			used on initialization to build table
			used during generation to find checked radio
			=============================================
			*/
			let extSourceTable = new Array();
			let intSourceTable = new Array();
			/*
			================================
			initialization
			to make the page ready to go
			================================
			*/
      var initGenerator = function(){
				/*
				==========================================
				are domain restrictions in place?
				add domain to beginning of the url input
				==========================================
				*/
        if (!settings.domain){}
				else $('#url-param-entry').before('<div class="input-group-prepend"><span class="input-group-text" id="utm-base-url">'+settings.domain+'</span></div>');
				/* 
				========================
				campaigns auto-complete
				coming soon
				tutorial saved***
				========================
				*/
				/*
				====================================================
				source/medium arrays generated: internal & external
				two arrays are easier to iterate in next step
				====================================================
				*/
				for(medium in settings.sources.external){
					settings.sources.external[medium].forEach(function(source){
						extSourceTable.push([medium,source]);
					});
				}
				// ===========================================================
				for(medium in settings.sources.internal){
					settings.sources.internal[medium].forEach(function(source){
						intSourceTable.push([medium,source]);
					});
				}
				/*
				========================================
				iterating through the sourceTable arrays
				building the html table row by row
				foreman variable watches do/while loop
				foreman ends loop at end of both arrays
				printing into the table body
				========================================
				*/
				let sourceTableHTML = '';
				let rowCount=0;
				let foreman=0;
				// ===========================================================
				do {
					sourceTableHTML += '<tr><td>'
					// ===========================================================
					if (extSourceTable[rowCount]) {
						let extLowerCase=extSourceTable[rowCount][1].toString().toLowerCase();
						sourceTableHTML += '<div class="form-check"><input class="form-check-input" type="radio" name="source-param-entry" id="source-'+extLowerCase+'" value="'+extLowerCase+'" data-scope="external" data-medium="'+extSourceTable[rowCount][0]+'"><label class="form-check-label" for="source-'+extLowerCase+'">'+extSourceTable[rowCount][1]+'</label></div>'
					}
					// ===========================================================
					sourceTableHTML += '</td><td>';
					// ===========================================================
					if(intSourceTable[rowCount]){
						let intLowerCase=intSourceTable[rowCount][1].toString().toLowerCase();
						sourceTableHTML += '<div class="form-check"><input class="form-check-input" type="radio" name="source-param-entry" id="source-'+intLowerCase+'" value="'+intLowerCase+'" data-scope="internal" data-medium="'+intSourceTable[rowCount][0]+'"><label class="form-check-label" for="source-'+intLowerCase+'">'+intSourceTable[rowCount][1]+'</label></div>'
					}
					// ===========================================================
					sourceTableHTML += '</td></tr>';
					// ===========================================================
					foreman=0;
					if(!extSourceTable[rowCount+1]) foreman++;
					if(!intSourceTable[rowCount+1]) foreman++;
					rowCount++;
				}
				while(foreman<2);
				// ===========================================================
				$('#source-param tbody').html(sourceTableHTML);
				/*
				=======================================
				content and term are totalllinktional
				to remove: add 'no' to settings object
				=======================================
				*/
				if (settings.content === 'no') $('#content-param').remove();
				if (settings.term === 'no') $('#term-param').remove();
      }
			/*
			=========================================
			link generator
			validates the entries (added soon)
			builds link based on form values
			reveals the copy button
			==========================================
			*/
      let generateLink = function(){
				if ($('#copyButton')) $('#copyButton').remove(); // remove copyButton so there isn't two.
				
				let linkURL = settings.domain + document.getElementById('url-param-entry').value.toLowerCase(); // mitigate url and backslash doubleups
				let linkCampaign = document.getElementById('campaign-param-entry').value; // spaces to dashes, limit to dashes and alphanumeric
				/* 
				=========================================================
				okay, using radio buttons isn't as easy as I had hoped.
				if i want values from them, i have to refer to them by ID
				example: #source-streamsend
				then I can grab dataset and value from the input field
				
				but first i need to identify which one is checked...
				this means I need to test each one and return  
				=========================================================
				*/
				// gotta scope these variables properly
				let linkSource = '';
				let linkMedium = '';
				let linkScope = '';
				let linkContent = '';
				let linkTerm = '';
				
				let fullSourceTable = extSourceTable.concat(intSourceTable);
				fullSourceTable.forEach(function(source){
					let sourceID = 'source-'+source[1].toLowerCase();
					if(document.getElementById(sourceID).checked){
						linkSource = document.getElementById(sourceID).value;
						linkMedium = document.getElementById(sourceID).dataset.medium;
						linkScope = document.getElementById(sourceID).dataset.scope;
					}
				});
				if (settings.content != 'no') {
					linkContent = document.getElementById('content-param-entry').value; // spaces to dashes, limit to dashes and alphanumeric
				}
				if (settings.term != 'no'){
					linkTerm = document.getElementById('term-param-entry').value; // not sure what to do with this
				}
				
				let campaignLink = '';
 				switch(linkScope){
					case 'external':
						campaignLink = linkURL+'?utm_campaign='+linkCampaign+'&utm_source='+linkSource+'&utm_medium='+linkMedium;
						if (settings.content != 'no') campaignLink += '&utm_content='+linkContent;
						if (settings.term != 'no') campaignLink += '&utm_term='+linkTerm;
						break;
					case 'internal':
						campaignLink = linkURL+'?itm_campaign='+linkCampaign+'&itm_source='+linkSource+'&itm_medium='+linkMedium;
						if (settings.content != 'no') campaignLink += '&itm_content='+linkContent;
						if (settings.term != 'no') campaignLink += '&itm_term='+linkTerm;
						break;
					default:
						campaignLink = "ERROR";
				}
				$('#gen-result').html(campaignLink);
				
				/*
				================
				add copy button
				================
				*/
				$('#gen-buttons').append(' <button id="copyButton" class="btn btn-outline-primary" data-clipboard-text="'+campaignLink+'">Copy to Clipboard</button>');
				new ClipboardJS('#copyButton');
      }
      $(function(){
				initGenerator();
      });
    </script>
  </body>
</html>